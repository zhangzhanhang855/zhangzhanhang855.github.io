<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ä¸‘ç‰Œ Balatro (Web Prototype)</title>
    <style>
        body {
            background-color: #2b5b3f; /* ç»å…¸çš„æ‰‘å…‹æ¡Œç»¿è‰² */
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #top-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        .stat-box { font-size: 1.2em; font-weight: bold; }
        .score-display { color: #f1c40f; font-size: 1.5em; }

        #play-area {
            height: 150px;
            width: 100%;
            max-width: 800px;
            border: 2px dashed #4ca86e;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            color: #ccc;
        }

        #hand {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            min-height: 140px;
        }

        .card {
            width: 90px;
            height: 130px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .card.red { color: #e74c3c; }
        .card.black { color: #2c3e50; }

        .card.selected {
            transform: translateY(-20px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.5), 0 0 10px #f1c40f;
            border: 2px solid #f1c40f;
        }

        .controls button {
            padding: 10px 20px;
            font-size: 1.2em;
            margin: 0 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background 0.2s;
        }

        #play-btn { background-color: #3498db; color: white; }
        #play-btn:hover { background-color: #2980b9; }
        
        #discard-btn { background-color: #e74c3c; color: white; }
        #discard-btn:hover { background-color: #c0392b; }

        .controls button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }

        #message {
            margin-top: 15px;
            font-size: 1.2em;
            height: 30px;
            color: #f1c40f;
        }
    </style>
</head>
<body>

    <div id="top-bar">
        <div class="stat-box">ç›®æ ‡åˆ†æ•°: <span id="target-score">300</span></div>
        <div class="stat-box score-display">æ€»åˆ†æ•°: <span id="total-score">0</span></div>
        <div class="stat-box">å‡ºç‰Œ: <span id="plays-left">4</span> | å¼ƒç‰Œ: <span id="discards-left">3</span></div>
    </div>

    <div id="play-area">
        ä¸Šæ¬¡å‡ºç‰Œ: <span id="last-play-info">æš‚æ— </span>
    </div>

    <div id="hand"></div>

    <div class="controls">
        <button id="play-btn" onclick="playCards()">å‡ºç‰Œ (0/5)</button>
        <button id="discard-btn" onclick="discardCards()">å¼ƒç‰Œ (0/5)</button>
    </div>

    <div id="message"></div>

<script>
    // æ¸¸æˆæ ¸å¿ƒæ•°æ®
    const suits = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
    const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    
    // åŸºç¡€ç‰Œå‹æ•°æ® (ç­¹ç , å€ç‡)
    const handTypes = {
        'å››æ¡': { chips: 150, mult: 7 },
        'åŒèŠ±': { chips: 80, mult: 4 },
        'ä¸‰æ¡': { chips: 40, mult: 3 },
        'ä¸¤å¯¹': { chips: 30, mult: 2 },
        'ä¸€å¯¹': { chips: 20, mult: 2 },
        'é«˜ç‰Œ': { chips: 10, mult: 1 }
    };

    let deck = [];
    let hand = [];
    let selectedCards = [];
    
    // å…³å¡çŠ¶æ€
    let state = {
        targetScore: 300,
        totalScore: 0,
        playsLeft: 4,
        discardsLeft: 3
    };

    // åˆå§‹åŒ–ç‰Œåº“
    function initDeck() {
        deck = [];
        for (let suit of suits) {
            for (let rank of ranks) {
                let value = parseInt(rank);
                if (['J', 'Q', 'K'].includes(rank)) value = 10;
                if (rank === 'A') value = 11;
                deck.push({ suit, rank, value, id: `${suit}${rank}` });
            }
        }
        // æ´—ç‰Œç®—æ³•
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    // æŠ½ç‰Œç›´åˆ°æ‰‹ç‰Œæ»¡8å¼ 
    function drawCards() {
        while (hand.length < 8 && deck.length > 0) {
            hand.push(deck.pop());
        }
        renderHand();
    }

    // æ¸²æŸ“æ‰‹ç‰Œ
    function renderHand() {
        const handDiv = document.getElementById('hand');
        handDiv.innerHTML = '';
        selectedCards = [];
        updateButtons();

        hand.forEach((card, index) => {
            const cardElement = document.createElement('div');
            cardElement.className = `card ${['â™¥', 'â™¦'].includes(card.suit) ? 'red' : 'black'}`;
            cardElement.innerHTML = `${card.suit}<br>${card.rank}`;
            
            cardElement.onclick = () => toggleSelectCard(cardElement, card, index);
            handDiv.appendChild(cardElement);
        });
    }

    // ç‚¹å‡»é€‰æ‹©/å–æ¶ˆé€‰æ‹©å¡ç‰Œ
    function toggleSelectCard(element, card, index) {
        const selectedIndex = selectedCards.findIndex(c => c.index === index);
        
        if (selectedIndex > -1) {
            selectedCards.splice(selectedIndex, 1);
            element.classList.remove('selected');
        } else {
            if (selectedCards.length < 5) {
                selectedCards.push({ card, index, element });
                element.classList.add('selected');
            }
        }
        updateButtons();
    }

    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    function updateButtons() {
        const count = selectedCards.length;
        document.getElementById('play-btn').innerText = `å‡ºç‰Œ (${count}/5)`;
        document.getElementById('discard-btn').innerText = `å¼ƒç‰Œ (${count}/5)`;
        
        document.getElementById('play-btn').disabled = count === 0 || state.playsLeft <= 0;
        document.getElementById('discard-btn').disabled = count === 0 || state.discardsLeft <= 0;
    }

    // ç‰Œå‹åˆ¤å®š (åŸºç¡€ç‰ˆ)
    function evaluateHand(cards) {
        if (cards.length === 0) return null;
        
        const rankCounts = {};
        const suitCounts = {};
        cards.forEach(c => {
            rankCounts[c.rank] = (rankCounts[c.rank] || 0) + 1;
            suitCounts[c.suit] = (suitCounts[c.suit] || 0) + 1;
        });

        const counts = Object.values(rankCounts).sort((a, b) => b - a);
        const isFlush = Object.values(suitCounts).some(count => count === 5); // å¿…é¡»5å¼ åŒèŠ±è‰²
        
        let handName = 'é«˜ç‰Œ';
        if (counts[0] === 4) handName = 'å››æ¡';
        else if (isFlush) handName = 'åŒèŠ±';
        else if (counts[0] === 3) handName = 'ä¸‰æ¡';
        else if (counts[0] === 2 && counts[1] === 2) handName = 'ä¸¤å¯¹';
        else if (counts[0] === 2) handName = 'ä¸€å¯¹';

        // è®¡ç®—åŸºç¡€ç­¹ç  (ç‰Œå‹åŸºç¡€ + å¡ç‰Œç‚¹æ•°)
        let cardChips = cards.reduce((sum, c) => sum + c.value, 0);
        let baseChips = handTypes[handName].chips + cardChips;
        let mult = handTypes[handName].mult;

        return { name: handName, chips: baseChips, mult: mult, total: baseChips * mult };
    }

    // å‡ºç‰Œé€»è¾‘
    function playCards() {
        if (selectedCards.length === 0 || state.playsLeft <= 0) return;

        const playedCards = selectedCards.map(s => s.card);
        const evaluation = evaluateHand(playedCards);

        // åŠ¨ç”»æç¤ºä¸è®°åˆ†
        state.playsLeft--;
        state.totalScore += evaluation.total;
        
        document.getElementById('last-play-info').innerHTML = 
            `ç‰Œå‹: <b>${evaluation.name}</b><br>ç­¹ç : <span style="color:#3498db">${evaluation.chips}</span> X å€ç‡: <span style="color:#e74c3c">${evaluation.mult}</span> = <b>${evaluation.total}</b> åˆ†`;
        
        showMessage(`æ‰“å‡º ${evaluation.name}ï¼è·å¾— ${evaluation.total} åˆ†ï¼`);

        removeSelectedAndRedraw();
        checkGameState();
    }

    // å¼ƒç‰Œé€»è¾‘
    function discardCards() {
        if (selectedCards.length === 0 || state.discardsLeft <= 0) return;
        
        state.discardsLeft--;
        showMessage(`å¼ƒæ‰äº† ${selectedCards.length} å¼ ç‰Œã€‚`);
        removeSelectedAndRedraw();
        updateUI();
    }

    // ç§»é™¤é€‰ä¸­ç‰Œå¹¶é‡æ–°æŠ½ç‰Œ
    function removeSelectedAndRedraw() {
        // ä»åå¾€å‰åˆ ï¼Œé¿å…ç´¢å¼•åç§»
        selectedCards.sort((a, b) => b.index - a.index).forEach(s => {
            hand.splice(s.index, 1);
        });
        selectedCards = [];
        drawCards();
        updateUI();
    }

    // æ›´æ–°ç•Œé¢çŠ¶æ€
    function updateUI() {
        document.getElementById('total-score').innerText = state.totalScore;
        document.getElementById('plays-left').innerText = state.playsLeft;
        document.getElementById('discards-left').innerText = state.discardsLeft;
    }

    function showMessage(msg) {
        const msgDiv = document.getElementById('message');
        msgDiv.innerText = msg;
        setTimeout(() => msgDiv.innerText = '', 3000);
    }

    // æ£€æŸ¥è¾“èµ¢çŠ¶æ€
    function checkGameState() {
        updateUI();
        if (state.totalScore >= state.targetScore) {
            alert("ğŸ‰ æ­å–œï¼ç›²æ³¨è¾¾æ ‡ï¼Œä½ èµ¢äº†ï¼");
            resetGame();
        } else if (state.playsLeft <= 0) {
            alert("ğŸ’€ å‡ºç‰Œæ¬¡æ•°è€—å°½ï¼Œåˆ†æ•°æœªè¾¾æ ‡ï¼Œæ¸¸æˆç»“æŸã€‚");
            resetGame();
        }
    }

    function resetGame() {
        state = { targetScore: 300, totalScore: 0, playsLeft: 4, discardsLeft: 3 };
        initDeck();
        hand = [];
        drawCards();
        updateUI();
        document.getElementById('last-play-info').innerText = 'æš‚æ— ';
    }

    // æ¸¸æˆåˆå§‹åŒ–å¯åŠ¨
    resetGame();
</script>

</body>
</html>
