<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æ–—åœ°ä¸»ç»ˆæä¸“ä¸šç‰ˆ</title>
<style>
body{margin:0;background:radial-gradient(circle,#164,#021);color:#fff;font-family:Segoe UI,Arial;text-align:center}
.table{max-width:1200px;margin:auto;padding:20px}
.panel{background:rgba(0,0,0,.6);padding:16px;border-radius:18px;margin:12px;box-shadow:0 0 18px #000}
.card{display:inline-block;padding:10px 14px;margin:4px;border-radius:10px;border:1px solid #fff;background:linear-gradient(#2ecc71,#166);cursor:pointer;transition:.2s;font-weight:bold;user-select:none}
.card:hover{transform:translateY(-6px)}
.selected{background:linear-gradient(#ffe066,#f1c40f);color:#000}
button{padding:12px 22px;border:none;border-radius:12px;background:linear-gradient(#f9d423,#f1c40f);font-weight:bold;cursor:pointer;box-shadow:0 4px 10px #000}
.status{font-size:18px}
.coins{font-size:22px;color:#ffd966}
</style>
</head>
<body>
<div class="table">
<h1>ğŸƒ æ–—åœ°ä¸»ç»ˆæä¸“ä¸šç‰ˆ</h1>
<div class="coins">ğŸ’° é‡‘å¸ï¼š<span id="coins">1000</span></div>

<div class="panel">
<h3>ä½ çš„æ‰‹ç‰Œ</h3>
<div id="player"></div>
</div>

<div class="panel">
<button onclick="autoSort()">è‡ªåŠ¨ç†ç‰Œ</button>
<button onclick="playCards()">å‡ºç‰Œ</button>
<button onclick="passTurn()">è¦ä¸èµ·</button>
<button onclick="startGame()">æ–°ä¸€å±€</button>
</div>

<div class="panel status">
åœ°ä¸»ï¼š<span id="landlord">æœªå®š</span> ï½œ å½“å‰å›åˆï¼š<span id="turn">ä½ </span><br>
ç‰Œå‹ï¼š<span id="currentType">æ— </span> ï½œ ä¸Šå®¶ç‚¹æ•°ï¼š<span id="currentRank">-</span>
</div>
</div>

<audio id="soundPlay" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="soundBomb" src="https://actions.google.com/sounds/v1/explosions/explosion.ogg"></audio>

<script>
const ranks=['3','4','5','6','7','8','9','10','J','Q','K','A','2','å°ç‹','å¤§ç‹'];
let deck=[],playerHand=[],ai1Hand=[],ai2Hand=[],bottom=[];
let selected=[],currentType=null,currentRank=null,currentPlayer='player';
let landlord='player',coins=1000,multiplier=1;

function rankValue(c){return ranks.indexOf(c)}

function buildDeck(){deck=[];for(let i=0;i<13;i++)for(let j=0;j<4;j++)deck.push(ranks[i]);deck.push('å°ç‹','å¤§ç‹');}
function shuffle(){for(let i=deck.length-1;i>0;i--){let r=Math.floor(Math.random()*(i+1));[deck[i],deck[r]]=[deck[r],deck[i]];}}

function startGame(){buildDeck();shuffle();playerHand=deck.slice(0,17);ai1Hand=deck.slice(17,34);ai2Hand=deck.slice(34,51);bottom=deck.slice(51);
 landlord=['player','ai1','ai2'][Math.floor(Math.random()*3)];
 if(landlord==='player')playerHand.push(...bottom);
 if(landlord==='ai1')ai1Hand.push(...bottom);
 if(landlord==='ai2')ai2Hand.push(...bottom);
 multiplier=1;currentType=null;currentRank=null;currentPlayer=landlord;
 autoSort();render();}

function autoSort(){playerHand.sort((a,b)=>rankValue(a)-rankValue(b));render();}

function toggleSelect(i){const idx=selected.indexOf(i);idx>-1?selected.splice(idx,1):selected.push(i);render();}

function render(){const p=document.getElementById('player');p.innerHTML='';playerHand.forEach((c,i)=>{const d=document.createElement('div');d.className='card'+(selected.includes(i)?' selected':'');d.innerText=c;d.onclick=()=>toggleSelect(i);
 d.addEventListener('touchstart',()=>toggleSelect(i));p.appendChild(d);});
 document.getElementById('turn').innerText=currentPlayer==='player'?'ä½ ':'ç”µè„‘';
 document.getElementById('landlord').innerText=landlord==='player'?'ä½ ':landlord==='ai1'?'ç”µè„‘A':'ç”µè„‘B';
 document.getElementById('currentType').innerText=currentType||'æ— ';
 document.getElementById('currentRank').innerText=currentRank??'-';
 document.getElementById('coins').innerText=coins;}

function getCards(){return selected.map(i=>playerHand[i]).sort((a,b)=>rankValue(a)-rankValue(b));}

function isBomb(c){return c.length===4&&rankValue(c[0])===rankValue(c[3]);}
function isKingBomb(c){return c.length===2&&c.includes('å°ç‹')&&c.includes('å¤§ç‹');}
function isPair(c){return c.length===2&&rankValue(c[0])===rankValue(c[1]);}
function isStraight(c){if(c.length<5)return false;for(let i=1;i<c.length;i++)if(rankValue(c[i])!==rankValue(c[i-1])+1)return false;return true;}

function detect(c){if(isKingBomb(c))return 'ç‹ç‚¸';if(isBomb(c))return 'ç‚¸å¼¹';if(c.length===1)return 'å•å¼ ';if(isPair(c))return 'å¯¹å­';if(isStraight(c))return 'é¡ºå­';return null;}

function stronger(type,rank){if(type==='ç‹ç‚¸')return true;if(type==='ç‚¸å¼¹'&&currentType!=='ç‹ç‚¸')return true;if(type===currentType&&rank>currentRank)return true;return false;}

function playCards(){if(currentPlayer!=='player')return;const c=getCards();if(!c.length)return;const type=detect(c);if(!type){alert('âŒ å‡ºç‰Œä¸åˆæ³•');return;}const rank=rankValue(c[c.length-1]);
 if(currentType&&!stronger(type,rank)){alert('âš  æ²¡æœ‰å‹è¿‡ä¸Šå®¶');return;}
 if(type.includes('ç‚¸')){multiplier*=2;document.getElementById('soundBomb').play();}
 else document.getElementById('soundPlay').play();
 currentType=type;currentRank=rank;
 selected.sort((a,b)=>b-a).forEach(i=>playerHand.splice(i,1));selected=[];
 nextAI();render();}

function nextAI(){currentPlayer='ai';setTimeout(()=>aiMove(ai1Hand),600)}

function aiMove(hand){if(hand.length===0)return;
 hand.sort((a,b)=>rankValue(a)-rankValue(b));
 let play=[hand[0]];let type='å•å¼ ';let rank=rankValue(play[0]);
 if(!currentType||stronger(type,rank)){
 currentType=type;currentRank=rank;hand.splice(0,1);
 }currentPlayer='player';render();}

function passTurn(){if(currentPlayer!=='player')return;currentType=null;currentRank=null;nextAI();}

startGame();
</script>
</body>
</html>
